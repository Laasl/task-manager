<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>Gestionnaire de tâches avec Firebase</title>
<style>
body {
font-family: Arial, sans-serif;
font-size: 20px;
line-height: 1.6;
padding: 20px;
background: #f5f5f5;
}
h2 {
margin-top: 40px;
}
form input, form textarea, form button {
font-size: 20px;
padding: 12px;
margin: 5px 0;
width: 100%;
box-sizing: border-box;
}
.task {
border-radius: 10px;
border: 1px solid #ccc;
padding: 20px;
margin: 15px 0;
cursor: pointer;
transition: background-color 0.3s ease;
}
.task.non-commence {
background-color: #ffffff;
color: #000;
}
.task.en-cours {
background-color: #ffb74d; /* orange */
color: #000;
}
.task.termine {
background-color: #4caf50; /* vert */
color: #fff;
text-decoration: line-through;
}
.description {
font-size: 22px;
margin: 12px 0;
}
button {
padding: 14px 24px;
font-size: 20px;
margin-top: 10px;
cursor: pointer;
}
</style>

<!-- Firebase SDKs -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
import { getFirestore, collection, addDoc, doc, updateDoc, deleteDoc, onSnapshot, query, orderBy, getDocs } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore.js";

const firebaseConfig = {
apiKey: "AIzaSyBqjP4QxVKT0LbNvSMVcdrhH0IKji4_XpA",
authDomain: "pdca-fb469.firebaseapp.com",
projectId: "pdca-fb469",
storageBucket: "pdca-fb469.firebasestorage.app",
messagingSenderId: "207233804691",
appId: "1:207233804691:web:c3f0ba6bc1212a2276e066",
measurementId: "G-SBW3W8TJ09"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const taskForm = document.getElementById('taskForm');
const taskListDiv = document.getElementById('taskList');
const deleteDoneBtn = document.getElementById('deleteDone');

const statusCycle = ['Non commencé', 'En cours', 'Terminé'];

function renderTasks(tasks) {
taskListDiv.innerHTML = '';
tasks.forEach(task => {
const div = document.createElement('div');
div.className = 'task ' + (task.status === 'Non commencé' ? 'non-commence' : task.status === 'En cours' ? 'en-cours' : 'termine');
div.innerHTML = `
<strong>${task.title}</strong><br>
<div class="description">${task.description}</div>
Du ${task.startDate} au ${task.endDate}<br>
<em>Statut: ${task.status}</em>
`;
div.onclick = async () => {
const currentIndex = statusCycle.indexOf(task.status);
const nextStatus = statusCycle[(currentIndex + 1) % statusCycle.length];
await updateDoc(doc(db, 'tasks', task.id), { status: nextStatus });
};
taskListDiv.appendChild(div);
});
}

const q = query(collection(db, 'tasks'), orderBy('startDate'));
onSnapshot(q, (snapshot) => {
const tasks = [];
snapshot.forEach(doc => {
tasks.push({ id: doc.id, ...doc.data() });
});
renderTasks(tasks);
});

taskForm.addEventListener('submit', async e => {
e.preventDefault();
const title = taskForm.title.value.trim();
const description = taskForm.description.value.trim();
const startDate = taskForm.startDate.value;
const endDate = taskForm.endDate.value;

if (!title || !description || !startDate || !endDate) {
alert("Merci de remplir tous les champs");
return;
}

await addDoc(collection(db, 'tasks'), {
title,
description,
startDate,
endDate,
status: 'Non commencé'
});

taskForm.reset();
});

deleteDoneBtn.onclick = async () => {
const snapshot = await getDocs(collection(db, 'tasks'));
const batchDeletes = snapshot.docs
.filter(docSnap => docSnap.data().status === 'Terminé')
.map(docSnap => deleteDoc(doc(db, 'tasks', docSnap.id)));

await Promise.all(batchDeletes);

};
</script>
</head>
<body>
<h2>Ajouter une tâche</h2>
<form id="taskForm">
<input name="title" type="text" placeholder="Titre" required />
<textarea name="description" placeholder="Description" required style="height: 80px;"></textarea>
<input name="startDate" type="date" required />
<input name="endDate" type="date" required />
<button type="submit">Ajouter</button>
</form>

<h2>Liste des tâches</h2>
<div id="taskList"></div>
<button id="deleteDone">Supprimer les tâches terminées</button>
</body>
</html>